import { Code } from "../../../components/Code/Code";

# Protecting API Routes

## Using `getServerSession`

To protect API Routes (blocking unauthorized access to resources), you can use [`getServerSession()`](https://next-auth.js.org/configuration/Next.js#getserversession) to know whether a session exists or not:

<Code>
<Code.Next>

```ts filename="pages/api/movies/list.ts"
import { getServerSession } from "next-auth";
import { auth } from "../../../auth";

export default async function listMovies(req, res) {
  const session = await getServerSession(req, res, auth);

  if (session) {
    res.send({
      movies: [
        { title: "Alien vs Predator", id: 1 },
        { title: "Reservoir Dogs", id: 2 },
      ],
    });
  } else {
    res.send({
      error: "You must sign in to view movies.",
    });
  }
}
```

</Code.Next>
</Code>

## Using `getToken`

If you are using JSON Web Tokens you can use the getToken() helper to access the contents of the JWT without having to handle JWT decryption/verification yourself. This method can only be used server side.

<Code>
<Code.Next>

```ts filename="pages/api/movies/list.ts"
// This is an example of how to read a JSON Web Token from an API route
import { getToken } from "next-auth/jwt";

export default async (req, res) => {
  // If you don't have NEXTAUTH_SECRET set, you will have to pass your secret as `secret` to `getToken`
  const token = await getToken({ req });
  if (token) {
    // Signed in
    console.log("JSON Web Token", JSON.stringify(token, null, 2));
  } else {
    // Not Signed in
    res.status(401);
  }
  res.end();
};
```

</Code.Next>
</Code>
