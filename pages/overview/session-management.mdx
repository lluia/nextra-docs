import { Callout } from "nextra/components";
import { RichTabs } from "../../components/RichTabs/RichTabs";
import { Code } from "../../components/Code/Code";
import {
  SignIn,
  SignOut,
  UserCircle,
  HardDrives,
  IdentificationBadge,
  GitFork,
  PaintBucket,
} from "@phosphor-icons/react";

# Managing the user session

Auth.js ships with lightweight utilities to help you manage the user's session easily. Aside from [built-in pages](/tutorials/custom-pages/built-in-pages), which are [themable](/tutorials/theming) or [fully customisable](/tutorials/custom-pages/custom-sign-in), Auth.js does not come with any built-in styles.

You're in charge of the building the UI for session management. Below we summarise some of the most common patterns that you'll need to setup to have your app production ready.

<RichTabs defaultValue="login">
  <RichTabs.TabList>
    <RichTabs.Tab value="login">
      <div className="flex flex-col justify-center items-center h-full">
        <SignIn fontSize="3rem" />
        <span>Handle sign in/out</span>
      </div>
    </RichTabs.Tab>
    <RichTabs.Tab value="user-menu">
      <div className="flex flex-col justify-center items-center h-full">
        <UserCircle fontSize="3rem" />
        <span>Display user menu</span>
      </div>
    </RichTabs.Tab>
    <RichTabs.Tab value="protecting">
      <div className="flex flex-col justify-center items-center h-full">
        <GitFork fontSize="3rem" />
        <span>Protecting routes</span>
      </div>
    </RichTabs.Tab>
    <RichTabs.Tab value="custom-pages">
      <div className="flex flex-col justify-center items-center h-full">
        <PaintBucket fontSize="3rem" />
        <span>Custom pages</span>
      </div>
    </RichTabs.Tab>
  </RichTabs.TabList>
  <RichTabs.Panels>

{/* <!-------------------------------> */}
{/* <!---------- LOGIN/LOGOUT -------> */}
{/* <!-------------------------------> */}

<RichTabs.Panel value="login">

### Handle sign in

<Code>
  <Code.Next>

```ts filename="./auth.ts"
import NextAuth from "next-auth";
import GitHub from "next-auth/providers/github";

export const { signIn, auth } = NextAuth({
  providers: [GitHub],
  pages: {
    signIn: "/auth/signin",
    signOut: "/auth/signout",
  },
});
```

```ts filename="./app/auth/signin/page.tsx"
import { signIn, providers } from "../../../auth";

// TODO
```

  </Code.Next>

  <Code.Svelte>

```ts filename="./src/hooks.server.ts"
import { SvelteKitAuth } from "@auth/sveltekit";
import GitHub from "@auth/sveltekit/providers/github";

export const handle = SvelteKitAuth({
  providers: [GitHub({ clientId: GITHUB_ID, clientSecret: GITHUB_SECRET })],
  pages: {
    signIn: "/login",
  },
});
```

  </Code.Svelte>
  <Code.Solid>

```ts filename="./src/routes/auth.ts
// TODO
import { SolidAuth } from "@auth/solid";

export const handleAuth = SolidAuth({
  ...
  pages: {
    signIn: "/login",
  },
});
```

  </Code.Solid>
  <Code.Express>

```ts filename="./auth.ts"
// TODO

import { ExpressAuth } from "@auth/express";
import GitHub from "next-auth/providers/github";

export const { signIn, auth } = ExpressAuth({
  providers: [GitHub],
  pages: {
    signIn: "/auth/signin",
    signOut: "/auth/signout",
  },
});
```

  </Code.Express>
</Code>

</RichTabs.Panel>

{/* <!-------------------------------> */}
{/* <!---------- Display user -------> */}
{/* <!-------------------------------> */}

<RichTabs.Panel value="user-menu">Navigation</RichTabs.Panel>

{/* <!-------------------------------> */}
{/* <!------ PROTECTING ROUTES -----> */}
{/* <!-------------------------------> */}

<RichTabs.Panel value="protecting">

### Redirecting users

You can extend the default `withAuth` middleware to redirect users depending on certain conditions, for example their role:

```ts
import { withAuth } from "next-auth/middleware";

export default withAuth(
  // `withAuth` augments your `Request` with the user's token.
  function middleware(req) {
    console.log(req.nextauth.token);
  },
  {
    callbacks: {
      authorized: ({ token }) => token?.role === "admin",
    },
  }
);

export const config = { matcher: ["/admin"] };
```

### Blocking access

...

### Middleware (Next.js)

With NextAuth.js 4.2.0 and Next.js 12, you can now protect your pages via the middleware pattern more easily. If you would like to protect all pages, you can create a `_middleware.ts` file in your root pages directory which looks like this:

```ts filename="./middleware.ts"
export { default } from "next-auth/middleware";
```

Otherwise, if you only want to protect a subset of pages, you could put it in a subdirectory as well, for example in `/app/admin/_middleware.ts` would protect all pages under the `/admin` route.

For the time being, middleware only supports **jwt** as a session strategy, so it won't work with databases.

</RichTabs.Panel>

</RichTabs.Panels>
</RichTabs>

<Callout>
  In the future, we might add more rich built-in components to the library if
  there's a need. [Let us
  know](https://github.com/nextauthjs/next-auth/issues/new/choose) what type of
  component you would like Auth.js to ship with.
</Callout>
